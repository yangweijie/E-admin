{"version":3,"sources":["webpack:///./src/components/spec.vue?94af","webpack:///./src/components/spec.vue","webpack:///./src/components/spec.vue?e9f8"],"names":["class","style","specGroup","clearable","selectHandel","group","item","key","id","value","label","name","data","specs","border","size","row-class-name","tableRowClassName","cellMouseLeave","cellMouseEnter","prop","default","scope","row","selected","spec","hoverIndex","$index","content","handleUp","selectSpec","handleDown","tableData","length","row-key","data-source","bordered","pagination","title","data-index","record","separator","type","effect","columns","column","index","slot-props","field","$attrs","validator","component","inheritAttrs","props","String","Array","specId","Number","modelValue","Object","emits","setup","ctx","state","selectValue","propsSpecs","unshift","map","selectSpecs","filter","num","indexOf","checkboxSpec","val","specParse","arr1","arr3","shift","forEach","item1","item2","push","concat","slice","arr","len","rowIndex","columnIndex","eadminIndex","cell","event","selectedArr","dataIndex","emit","e","deep","render","__scopeId"],"mappings":"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","file":"static/js/chunk-5bde973e.90616445.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./spec.vue?vue&type=style&index=0&id=6c584784&scoped=true&lang=css\"","<template>\r\n    <el-select v-model=\"specGroup\" style=\"width: 100%;margin-bottom: 5px\" clearable @change=\"selectHandel\">\r\n        <el-option v-for=\"item in group\" :key=\"item.id\" :value=\"item.id\" :label=\"item.name\"></el-option>\r\n    </el-select>\r\n    <el-table :data=\"specs\" border size=\"mini\" v-if=\"specGroup\" style=\"margin-bottom: 5px\" :row-class-name=\"tableRowClassName\" @cell-mouse-leave=\"cellMouseLeave\" @cell-mouse-enter=\"cellMouseEnter\">\r\n        <el-table-column\r\n                prop=\"name\"\r\n                label=\"可选规格\">\r\n        </el-table-column>\r\n        <el-table-column\r\n                label=\"规格内容\">\r\n            <template #default=\"scope\">\r\n                <div class=\"specValue\">\r\n                    <el-checkbox-group v-model=\"scope.row.selected\">\r\n                        <el-checkbox v-for=\"item in scope.row.spec\" :label=\"item\"></el-checkbox>\r\n                    </el-checkbox-group>\r\n                    <div class=\"action\" v-if=\"hoverIndex === scope.$index\">\r\n                        <el-tooltip content=\"上移\">\r\n                            <i class=\"el-icon-caret-top\" @click=\"handleUp(selectSpec,scope.$index)\"></i>\r\n                        </el-tooltip>\r\n                        <el-tooltip content=\"下移\">\r\n                            <i class=\"el-icon-caret-bottom\" @click=\"handleDown(selectSpec,scope.$index)\"></i>\r\n                        </el-tooltip>\r\n                    </div>\r\n                </div>\r\n            </template>\r\n        </el-table-column>\r\n    </el-table>\r\n    <a-table row-key=\"group\" :data-source=\"tableData\" v-if=\"tableData.length > 0\" size=\"small\" bordered :pagination=\"false\">\r\n        <a-table-column title=\"规格\" data-index=\"eadminSpecGroup\">\r\n            <template #default=\"{ record }\">\r\n                <el-breadcrumb separator=\"|\">\r\n                    <el-breadcrumb-item v-for=\"item in record.group\">\r\n                        <el-tag size=\"mini\" type=\"info\" effect=\"dark\" class=\"tag\">{{item.name}}</el-tag>\r\n                        <el-tag size=\"mini\" effect=\"dark\">{{item.value}}</el-tag>\r\n                    </el-breadcrumb-item>\r\n                </el-breadcrumb>\r\n            </template>\r\n        </a-table-column>\r\n        <a-table-column v-for=\"column in columns\" :title=\"column.title\" :data-index=\"column.prop\">\r\n            <template #default=\"{ record , index}\">\r\n                <div style=\"margin: 10px 0\">\r\n                    <render :slot-props=\"{ row:record ,$index:index ,propField:field,validator:$attrs.validator}\" :data=\"column.component\"></render>\r\n                </div>\r\n            </template>\r\n        </a-table-column>\r\n    </a-table>\r\n</template>\r\n\r\n<script>\r\n    import {defineComponent, reactive, toRefs, computed, watch,watchEffect,toRaw} from \"vue\";\r\n    import {findTree} from \"@/utils\";\r\n\r\n    export default defineComponent({\r\n        name: \"EadminSpec\",\r\n        inheritAttrs: false,\r\n        props: {\r\n            field:String,\r\n            data: Array,\r\n            specId: {\r\n                type:[String, Number],\r\n                default:'',\r\n            },\r\n            specs: [Array, String],\r\n            columns: Array,\r\n            modelValue: [Object, Array, String],\r\n        },\r\n        emits: ['update:modelValue', 'update:specs'],\r\n        setup(props, ctx) {\r\n            const state = reactive({\r\n                group:[],\r\n                specGroup: props.specId == '' ? '':'select'+props.specId,\r\n                selectSpec: [],\r\n                hoverIndex:-1,\r\n                tableData:[],\r\n            })\r\n            let selectValue = props.modelValue\r\n            let propsSpecs = props.specs\r\n            if(propsSpecs){\r\n                props.data.unshift({\r\n                    id:'select'+props.specId,\r\n                    name:'当前规格',\r\n                    specs:toRaw(propsSpecs)\r\n                })\r\n\r\n            }\r\n            state.group = props.data\r\n            //规格分组\r\n            const specs = computed(() => {\r\n                const spec = findTree(state.group, state.specGroup, 'id')\r\n                if (spec) {\r\n                    state.selectSpec = spec.specs.map((item, index) => {\r\n                        const selectSpecs = findTree(propsSpecs, item.name, 'name')\r\n                        item.selected = item.spec.filter(function (num) {\r\n                            if(selectSpecs){\r\n                                return selectSpecs.spec.indexOf(num) !== -1;\r\n                            }\r\n                            return false\r\n                        })\r\n\r\n                        return item\r\n                    })\r\n                    return state.selectSpec\r\n                } else {\r\n                    return []\r\n                }\r\n            })\r\n            let checkboxSpec = []\r\n\r\n            watchEffect(() => {\r\n                let data = []\r\n                let selectedArr = []\r\n                checkboxSpec = []\r\n                state.selectSpec.forEach(item => {\r\n                    checkboxSpec.push({name: item.name, spec: item.selected})\r\n                    let arr = []\r\n                    item.selected.forEach(selected => {\r\n                        arr.push({\r\n                            group: [{name: item.name, value: selected}],\r\n                            spec: selected\r\n                        })\r\n                    })\r\n                    selectedArr.push(arr)\r\n                })\r\n                if (selectedArr.length > 0) {\r\n                    data = specParse(selectedArr, data)\r\n                    if (data.length > 0) {\r\n                        data = data.shift()\r\n                    }\r\n                }\r\n\r\n                data =  data.map(item => {\r\n                    const spec = findTree(selectValue, item.spec, 'spec')\r\n                    props.columns.forEach(column => {\r\n                        if (spec) {\r\n                            item[column.dataIndex] = spec[column.dataIndex]\r\n                        } else {\r\n                            item[column.dataIndex] = ''\r\n                        }\r\n                    })\r\n                    return item\r\n                })\r\n                state.tableData = data\r\n            })\r\n\r\n            watch(()=>state.tableData , value => {\r\n                selectValue = value\r\n                try {\r\n                    ctx.emit('update:specs', checkboxSpec)\r\n                    ctx.emit('update:modelValue', value)\r\n                }catch (e) {\r\n\r\n                }\r\n            },{deep:true})\r\n            function selectHandel(val) {\r\n                state.selectSpec = []\r\n            }\r\n            function specParse(arr1, arr3) {\r\n                if (arr1[0] && arr1[0].length === 0) {\r\n                    arr1.shift()\r\n                    if (arr1.length > 1) {\r\n                        return specParse(arr1, arr3)\r\n                    } else if (arr1.length == 1) {\r\n                        return arr1\r\n                    }\r\n                    return arr3\r\n                }\r\n                arr1[0].forEach(item1 => {\r\n                    if (arr1[1].length > 0) {\r\n                        arr1[1].forEach(item2 => {\r\n                            arr3.push({\r\n                                group: item1.group.concat(item2.group),\r\n                                spec: `${item1.spec}-${item2.spec}`\r\n                            })\r\n                        });\r\n                    } else {\r\n                        arr3.push({\r\n                            group: item1.group,\r\n                            spec: item1.spec,\r\n                        })\r\n                    }\r\n                });\r\n                arr1 = arr1.slice(2)\r\n                arr1.unshift(arr3)\r\n                arr3 = []\r\n                if (arr1.length > 1) {\r\n                    return specParse(arr1, arr3)\r\n                } else {\r\n                    return arr1\r\n                }\r\n            }\r\n            // 上移\r\n            function handleUp (arr,index) {\r\n                if(index > 0){\r\n                    const len = arr[index - 1]\r\n                    arr[index - 1] = arr[index]\r\n                    arr[index] = len\r\n                }\r\n\r\n            }\r\n            // 下移\r\n            function handleDown (arr,index) {\r\n                if(arr.length-1 > index){\r\n                    const len = arr[index + 1]\r\n                    arr[index + 1] = arr[index]\r\n                    arr[index] = len\r\n                }\r\n            }\r\n            function tableRowClassName({row, column, rowIndex, columnIndex}){\r\n                row.eadminIndex = rowIndex;\r\n            }\r\n            //当单元格 hover 进入时会触发该事件\r\n            function cellMouseEnter(row, column, cell, event){\r\n                state.hoverIndex = row.eadminIndex\r\n            }\r\n            //当单元格 hover 退出时会触发该事件\r\n            function cellMouseLeave(row, column, cell, event){\r\n                state.hoverIndex = -1\r\n            }\r\n\r\n\r\n            return {\r\n                tableRowClassName,\r\n                cellMouseEnter,\r\n                cellMouseLeave,\r\n                handleUp,\r\n                handleDown,\r\n                selectHandel,\r\n                specs,\r\n                ...toRefs(state)\r\n            }\r\n        }\r\n    })\r\n</script>\r\n\r\n<style scoped>\r\n    .tag {\r\n        margin-right: 5px;\r\n    }\r\n\r\n    .specValue {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n    }\r\n    .specValue i{\r\n        font-size: 14px;\r\n        margin-right: 5px;\r\n        cursor: pointer;\r\n    }\r\n    .specValue .action{\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n</style>\r\n","import { render } from \"./spec.vue?vue&type=template&id=6c584784&scoped=true\"\nimport script from \"./spec.vue?vue&type=script&lang=js\"\nexport * from \"./spec.vue?vue&type=script&lang=js\"\n\nimport \"./spec.vue?vue&type=style&index=0&id=6c584784&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-6c584784\"\n\nexport default script"],"sourceRoot":""}